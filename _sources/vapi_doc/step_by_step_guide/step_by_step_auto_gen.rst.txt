.. _vapi-step_by_step_auto_gen:

Step-by-Step: Create IDL Interfaces, Vehicle Devices and Basic Services
=======================================================================


.. note::

   **Step Goal**
   
   In this guide, you will learn how to manually generate VSS components, IDL interfaces, and basic services for a vehicle-related example using the SDV framework tools.
   
   The goal is to understand each step clearly before automating the process with CMake.  
   
   No coding is required, just follow the steps and observe how the tools generate the necessary files for you.
   

.. seealso:: For detailed tool descriptions, see :ref:`See component stack <vapi-utilities_auto_code_generation>`

Prerequisites
^^^^^^^^^^^^^

Before starting the code generation steps, ensure that your development environment is properly set up.

.. seealso:: Refer to the :ref:`installation steps <vapi-get_started>`.	


.. important:: In this step we define the signals and the interfaces. With this information we create the IDL interfaces, vehicle devices and basic services which will process the signal by events. No code implementation required by the developer. It is recommended to execute the steps manually first to verify correctness before automating them in CMake.

Manual Code Generation Steps
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

1. Copy the 'tmp_project' folder from the framework project to a local directory
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

.. code-block:: text

	Example: D:/VAPI_Project_Test/tmp_project/

2. Create subfolder and a CMakeLists.txt file for your example project
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

	Example: D:/VAPI_Project_Test/tmp_project/wiper_example

The content of the CMakeList.txt:

.. code-block:: text

	project(WiperDemoExample)
	cmake_policy(SET CMP0048 NEW)
	cmake_policy(SET CMP0092 NEW)
	set(CMAKE_CXX_STANDARD 17)
	set(CMAKE_CXX_VISIBILITY_PRESET hidden)
	include_directories(${SDV_FRAMEWORK_DEV_INCLUDE})

Add the subfolder to the CMakeLists.txt file in the root folder.

3. Prepare your :ref:`input-files`
""""""""""""""""""""""""""""""""""

- ``vss_wiper_example.csv``

.. raw:: html

   <details>
   <summary>Create file (vss_wiper_example.csv), view and copy content of CSV example</summary>

.. code-block:: text

	;Class name;Function name;Signal name;vss;Signal direction;type;DBC CAN name includes CAN message name; Formula
	;;;;;;;
	VD;FrontWiper;IsFrontActive;frontWiperActive;Vehicle.Body.Windshield.Wiper.Front;TX;boolean;CAN_Output_W.FrontWiperActive
	VD;RearWiper;IsRearActive;rearWiperActive;Vehicle.Body.Windshield.Wiper.Rear;TX;boolean;CAN_Output_W.RearWiperActive
	VD;WiperMode;Mode;wiperMode;Vehicle.Body.Windshield.Wiper.Mode;RX;string;CAN_Input_M.WiperMode; sdv::string wiperMode = value.get<sdv::string>();    if (!wiperMode.compare(""0"")) wiperMode = ""manual"";    if (!wiperMode.compare(""1"")) wiperMode = ""auto""; ;
	VD;RainSensor;Detected;rainDetected;Vehicle.Body.Weather.Rain;RX;boolean;CAN_Input_R.RainDetected
	BS;FrontWiper;IsFrontActive;frontWiperActive;Vehicle.Body.Windshield.Wiper.Front;TX;boolean;Vehicle.Body.Windshield.Wiper.Front
	BS;RearWiper;IsRearActive;rearWiperActive;Vehicle.Body.Windshield.Wiper.Rear;TX;boolean;Vehicle.Body.Windshield.Wiper.Rear
	BS;WiperMode;Mode;wiperMode;Vehicle.Body.Windshield.Wiper.Mode;RX;string;Vehicle.Body.Windshield.Wiper.Mode
	BS;RainSensor;Detected;rainDetected;Vehicle.Body.Weather.Rain;RX;boolean;Vehicle.Body.Weather.Rain

.. raw:: html

   </details>

Signal definition:

	- Vehicle Device and Basic Services will use the same vss interface definition
	- RX signal (input), rain detection: boolean, Vehicle.Body.Weather.Rain
	- RX signal (input), wiper mode: string, Vehicle.Body.Windshield.Wiper.Mode 
	- TX signal (output), front wiper status: boolean, Vehicle.Body.Windshield.Wiper.Front
	- TX signal (output), rear wiper status: boolean, Vehicle.Body.Windshield.Wiper.Rear

CSV File and Formulas
""""""""""""""""""""""
The CSV file defines signals, their types, and optional formulas. For example, WiperMode is defined as a string, but CAN cannot transmit strings.

.. note::

   Because WiperMode is defined as a **string** in the CSV, it cannot be transmitted as a string over CAN. For this reason, a formula was added in the CSV to map numeric values to strings: `0` represents **manual**, and `1` represents **auto**. On CAN, we send `0` or `1`, and the application converts these values back to the corresponding string using the formula.

   In the generated Vehicle Device code the function `ExecuteAllCallBacksForWiperMode()` was generated and applies this conversion automatically before invoking callbacks.


4. Generate VSS components
""""""""""""""""""""""""""

.. seealso:: Tool reference: :ref:`sdv_vss_util`

.. code-block:: console

       SDV_VSS_UTIL.exe vss_wiper_example.csv -Ogenerated/ --prefixwiper --version1.0.0.1 --enable_components

Verification:
'''''''''''''

After executing the ``sdv_vss_util``, following files will be in the generated folder.


.. raw:: html

   <details>
   <summary> View Folder Output Structure </summary>
   <pre>
   
   generated/vss_files/
   +-- bs_frontwiper/
   |   +-- bs_frontwiper.cpp
   |   +-- bs_frontwiper.h
   |   +-- cmakelists.txt
   +-- bs_rainsensor/
   |   +-- bs_rainsensor.cpp
   |   +-- bs_rainsensor.h
   |   +-- cmakelists.txt
   +-- bs_rearwiper/
   |   +-- bs_rearwiper.cpp
   |   +-- bs_rearwiper.h
   |   +-- cmakelists.txt
   +-- bs_wipermode/
   |   +-- bs_wipermode.cpp
   |   +-- bs_wipermode.h
   |   +-- cmakelists.txt
   +-- vd_frontwiper/
   |   +-- vd_frontwiper.cpp
   |   +-- vd_frontwiper.h
   |   +-- cmakelists.txt
   +-- vd_rainsensor/
   |   +-- vd_rainsensor.cpp
   |   +-- vd_rainsensor.h
   |   +-- cmakelists.txt
   +-- vd_rearwiper/
   |   +-- vd_rearwiper.cpp
   |   +-- vd_rearwiper.h
   |   +-- cmakelists.txt
   +-- vd_wipermode/
   |   +-- vd_wipermode.cpp
   |   +-- vd_wipermode.h
   |   +-- cmakelists.txt
   +-- signalidentifier.h
   +-- summary.txt
   +-- vss_vehiclebodyweatherrain_bs_rx.idl
   +-- vss_vehiclebodyweatherrain_vd_rx.idl
   +-- vss_vehiclebodywindshieldwiperfront_bs_tx.idl
   +-- vss_vehiclebodywindshieldwiperfront_vd_tx.idl
   +-- vss_vehiclebodywindshieldwipermode_bs_rx.idl
   +-- vss_vehiclebodywindshieldwipermode_vd_rx.idl
   +-- vss_vehiclebodywindshieldwiperrear_bs_tx.idl
   +-- vss_vehiclebodywindshieldwiperrear_vd_tx.idl

   </pre>
   </details>

The single signal definition (single line) of the front wiper basic service in the ``vss_wiper_example.csv`` file will produce following files: 

.. code-block:: console

	BS;FrontWiper;IsActive;frontWiperActive;Vehicle.Body.Windshield.Wiper.Front;TX;boolean;Vehicle.Body.Windshield.Wiper.Front


.. raw:: html

   <details>
   <summary> View bs_frontwiper.h </summary>
   <pre>
   
	/**
	 * @file BS_FrontWiper.h
	 * @date 2025-11-26 14:57:56
	 * File is auto generated from VSS utility
	 * VSS Version:1.0.0.1
	 */
	#ifndef __VSS_GENERATED__BS_FRONTWIPER_H_20251126_145756_462__
	#define __VSS_GENERATED__BS_FRONTWIPER_H_20251126_145756_462__

	#include <iostream>
	#include <support/component_impl.h>
	#include "../vss_vehiclebodywindshieldwiperfront_vd_tx.h"
	#include "../vss_vehiclebodywindshieldwiperfront_bs_tx.h"

	/**
	 * @brief basic service FrontWiper
	 */
	class CBasicServiceFrontWiper
		: public sdv::CSdvObject
		, public vss::Vehicle::Body::Windshield::Wiper::FrontService::IVSS_SetIsFrontActive
	{
	public:

		BEGIN_SDV_INTERFACE_MAP()
			SDV_INTERFACE_ENTRY(sdv::CSdvObject)
			SDV_INTERFACE_ENTRY(vss::Vehicle::Body::Windshield::Wiper::FrontService::IVSS_SetIsFrontActive)
		END_SDV_INTERFACE_MAP()

		DECLARE_OBJECT_CLASS_TYPE(sdv::EObjectType::BasicService)
		DECLARE_OBJECT_CLASS_NAME("Vehicle.Body.Windshield.Wiper.Front_Service")

		/**
		* @brief Constructor
		*/
		CBasicServiceFrontWiper();
		
		/**
		 * @brief Set frontWiperActive signal
		 * @param[in] value 
		 * @return true on success otherwise false
		 */
		bool SetIsFrontActive(bool value) override;

	private:
		
		vss::Vehicle::Body::Windshield::Wiper::FrontDevice::IVSS_WriteIsFrontActive* m_ptrIsFrontActive = nullptr;
	};

	DEFINE_SDV_OBJECT(CBasicServiceFrontWiper)

	#endif // !define __VSS_GENERATED__BS_FRONTWIPER_H_20251126_145756_462__



.. raw:: html

   <details>
   <summary> View bs_frontwiper.cpp </summary>
   <pre>
	/**
	 * @file BS_FrontWiper.cpp
	 * @date 2025-11-26 14:57:56
	 * File is auto generated from VSS utility
	 * VSS Version:1.0.0.1
	 */
	#include <iostream>
	#include "bs_frontwiper.h"

	/**
	 * @brief Constructor
	 */
	CBasicServiceFrontWiper::CBasicServiceFrontWiper()
	{
		m_ptrIsFrontActive = sdv::core::GetObject("Vehicle.Body.Windshield.Wiper.Front_Device").GetInterface<vss::Vehicle::Body::Windshield::Wiper::FrontDevice::IVSS_WriteIsFrontActive>();
		if (!m_ptrIsFrontActive)
		{
			SDV_LOG_ERROR("Could not get interface 'IVSS_WriteIsFrontActive': [CBasicServiceFrontWiper]");
			throw std::runtime_error("IsFrontActive device not found");
		}

		SDV_LOG_TRACE("CBasicServiceFrontWiper created.");
	}

	/**
	 * @brief IsFrontActive
	 * @param[in] value
	 * @return true on success otherwise false 
	 */
	bool CBasicServiceFrontWiper::SetIsFrontActive(bool value)
	{
		return m_ptrIsFrontActive->WriteIsFrontActive(value);
	}
   </pre>
   </details>
   
.. raw:: html

   <details>
   <summary> View vss_vehiclebodyweatherrain_bs_rx.idl </summary>
   <pre>

	/**
	 * @file VSS_VehicleBodyWeatherRain_bs_rx.idl
	 * @date 2025-10-14 22:10:50
	 * File is auto generated from VSS utility.
	 * VSS Version:1.0.0.1
	 */
	#include "interfaces/core.idl"
	#include "VSS_VehicleBodyWeatherRain_vd_rx.idl"

	module vss
	{
		module Vehicle
		{
			module Body
			{
				module Weather
				{
					module RainService
					{
						/**
						* @brief IVSS_SetDetected event interface
						*/            
						interface IVSS_SetDetected_Event
						{
							/**
							* @brief Set rainDetected signal
							* @param[in] value rainDetected
							*/
							void SetDetected(in boolean value);
						};

						/**
						* @brief IVSS_GetDetected Service interface
						*/
						interface IVSS_GetDetected
						{
							/**
							* @brief Get rainDetected signal
							* @return Returns the rainDetected
							*/
							boolean GetDetected() const;

							/**
							* @brief Register Callback on signal change
							* @param[in] callback function
							*/
							void RegisterOnSignalChangeOfRainDetected(in vss::Vehicle::Body::Weather::RainService::IVSS_SetDetected_Event callback);

							/**
							* @brief Unregister Callback
							* @param[in] callback function
							*/
							void UnregisterOnSignalChangeOfRainDetected(in vss::Vehicle::Body::Weather::RainService::IVSS_SetDetected_Event callback);
						};
					};
				};
			};
		};
	};

   </pre>
   </details>   

``signal_identifier.h`` is a generated header file that contains unique identifiers for all signals names defined in the input CSV.

.. raw:: html

	<details>
	<summary> View signal_identifier.h </summary>
	<pre>
	 /**
	 * @file signal_identifier.h
	 * @date 2025-10-14 22:10:50
	 * File is auto generated from VSS utility.
	 * VSS Version:1.0.0.1
	 */
	#ifndef __VSS_GENERATED__SIGNAL_IDENTIFIER_H_20251014_221050_829__
	#define __VSS_GENERATED__SIGNAL_IDENTIFIER_H_20251014_221050_829__

	namespace wiper
	{
		// Data Dispatch Service  signal names      to  dbc variable names                 C-type       RX/TX  vss name space
		static std::string      dsFrontWiperActive  =  "CAN_Output_W.FrontWiperActive"; ///< bool         TX     Vehicle.Body.Windshield.Wiper.Front 
		static std::string      dsRearWiperActive   =  "CAN_Output_W.RearWiperActive" ; ///< bool         TX     Vehicle.Body.Windshield.Wiper.Rear  
		static std::string      dsWiperMode         =  "CAN_Input_M.WiperMode"        ; ///< sdv::string  RX     Vehicle.Body.Windshield.Wiper.Mode  
		static std::string      dsRainDetected      =  "CAN_Input_R.RainDetected"     ; ///< bool         RX     Vehicle.Body.Weather.Rain           
	} // wiper

	#endif // __VSS_GENERATED__SIGNALIDENTIFIER_H_20251014_221050_829__

	</pre>
	</details> 
   
5. Compile IDL files for each generated component using SDV_IDL_COMPILER
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

.. seealso:: Tool reference: :ref:`sdv_idl_compiler`

Now the IDL files need to be compiled with the ``sdv_idl_compiler``

The :term:`Vehicle Device` interfaces are not to meant to be used from another process, so it is recommended to compile it with --no_ps option.

The interfaces of :term:`Basic Service` s instead need to be accessible from another processes. Therefore we cannot use the --no_ps option. Use --ps_lib_name<some_name> instead to give the binary a name.

Repeat for all .idl files in ``generated/vss_files/``

.. code-block:: console

       SDV_IDL_COMPILER.exe generated/vss_files/VSS_VehicleBodyWeatherRain_vd_rx.idl -Ogenerated/vss_files/ -I<export_path> -Igenerated/vss_files/ --no_ps
       SDV_IDL_COMPILER.exe generated/vss_files/VSS_VehicleBodyWindshieldWiperMode_vd_rx.idl -Ogenerated/vss_files/ -I<export_path> -Igenerated/vss_files/ --no_ps
       SDV_IDL_COMPILER.exe generated/vss_files/VSS_VehicleBodyWindshieldWiperFront_vd_tx.idl -Ogenerated/vss_files/ -I<export_path> -Igenerated/vss_files/ --no_ps
       SDV_IDL_COMPILER.exe generated/vss_files/VSS_VehicleBodyWindshieldWiperRear_vd_tx.idl -Ogenerated/vss_files/ -I<export_path> -Igenerated/vss_files/ --no_ps
       SDV_IDL_COMPILER.exe generated/vss_files/VSS_VehicleBodyWeatherRain_bs_rx.idl -Ogenerated/vss_files/ -I<export_path> -Igenerated/vss_files/ --ps_lib_namewiper_proxystub
       SDV_IDL_COMPILER.exe generated/vss_files/VSS_VehicleBodyWindshieldWiperMode_bs_rx.idl -Ogenerated/vss_files/ -I<export_path> -Igenerated/vss_files/ --ps_lib_namewiper_proxystub
       SDV_IDL_COMPILER.exe generated/vss_files/VSS_VehicleBodyWindshieldWiperFront_bs_tx.idl -Ogenerated/vss_files/ -I<export_path> -Igenerated/vss_files/  --ps_lib_namewiper_proxystub  
       SDV_IDL_COMPILER.exe generated/vss_files/VSS_VehicleBodyWindshieldWiperRear_bs_tx.idl -Ogenerated/vss_files/ -I<export_path> -Igenerated/vss_files/  --ps_lib_namewiper_proxystub

6. Automate Code Generation with CMake
""""""""""""""""""""""""""""""""""""""

.. tip::  
   If you update the `.csv` file, you may delete the previously generated files manually.  
   In case the files are blocked somehow, they may not be overwritten.

After verifying the manual steps, you can automate the process using CMake. Below is an example snippet from ``CMakeLists.txt``:

.. code-block:: cmake

    project(WiperDemoExample)
    cmake_policy(SET CMP0048 NEW)
    cmake_policy(SET CMP0092 NEW)
    set(CMAKE_CXX_STANDARD 17)
    set(CMAKE_CXX_VISIBILITY_PRESET hidden)
    include_directories(${SDV_FRAMEWORK_DEV_INCLUDE})

    # Generate VSS components
    execute_process(COMMAND "${SDV_VSS_UTIL}" "${PROJECT_SOURCE_DIR}/vss_wiper_example.csv" "-O${PROJECT_SOURCE_DIR}/generated/" --prefixwiper --version1.0.0.1 --enable_components)

    # Compile IDL files
    execute_process(COMMAND "${SDV_IDL_COMPILER}" "${PROJECT_SOURCE_DIR}/generated/vss_files/vss_vehiclebodyweatherrain_vd_rx.idl" "-O${PROJECT_SOURCE_DIR}/generated/vss_files/" "-I${SDV_FRAMEWORK_DEV_INCLUDE}" -Igenerated/vss_files/ --no_ps)
    execute_process(COMMAND "${SDV_IDL_COMPILER}" "${PROJECT_SOURCE_DIR}/generated/vss_files/vss_vehiclebodywindshieldwipermode_vd_rx.idl" "-O${PROJECT_SOURCE_DIR}/generated/vss_files/" "-I${SDV_FRAMEWORK_DEV_INCLUDE}" -Igenerated/vss_files/ --no_ps)
    execute_process(COMMAND "${SDV_IDL_COMPILER}" "${PROJECT_SOURCE_DIR}/generated/vss_files/vss_vehiclebodywindshieldwiperfront_vd_tx.idl" "-O${PROJECT_SOURCE_DIR}/generated/vss_files/" "-I${SDV_FRAMEWORK_DEV_INCLUDE}" -Igenerated/vss_files/ --no_ps)
    execute_process(COMMAND "${SDV_IDL_COMPILER}" "${PROJECT_SOURCE_DIR}/generated/vss_files/vss_vehiclebodywindshieldwiperrear_vd_tx.idl" "-O${PROJECT_SOURCE_DIR}/generated/vss_files/" "-I${SDV_FRAMEWORK_DEV_INCLUDE}" -Igenerated/vss_files/ --no_ps)

    execute_process(COMMAND "${SDV_IDL_COMPILER}" "${PROJECT_SOURCE_DIR}/generated/vss_files/vss_vehiclebodyweatherrain_bs_rx.idl" "-O${PROJECT_SOURCE_DIR}/generated/vss_files/" "-I${SDV_FRAMEWORK_DEV_INCLUDE}" -Igenerated/vss_files/ --ps_lib_namewiper_proxystub)
    execute_process(COMMAND "${SDV_IDL_COMPILER}" "${PROJECT_SOURCE_DIR}/generated/vss_files/vss_vehiclebodywindshieldwipermode_bs_rx.idl" "-O${PROJECT_SOURCE_DIR}/generated/vss_files/" "-I${SDV_FRAMEWORK_DEV_INCLUDE}" -Igenerated/vss_files/ --ps_lib_namewiper_proxystub)
    execute_process(COMMAND "${SDV_IDL_COMPILER}" "${PROJECT_SOURCE_DIR}/generated/vss_files/vss_vehiclebodywindshieldwiperfront_bs_tx.idl" "-O${PROJECT_SOURCE_DIR}/generated/vss_files/" "-I${SDV_FRAMEWORK_DEV_INCLUDE}" -Igenerated/vss_files/ --ps_lib_namewiper_proxystub)
    execute_process(COMMAND "${SDV_IDL_COMPILER}" "${PROJECT_SOURCE_DIR}/generated/vss_files/vss_vehiclebodywindshieldwiperrear_bs_tx.idl" "-O${PROJECT_SOURCE_DIR}/generated/vss_files/" "-I${SDV_FRAMEWORK_DEV_INCLUDE}" -Igenerated/vss_files/ --ps_lib_namewiper_proxystub)

    # Include proxy and stub binary
    add_subdirectory(generated/vss_files/ps)

    # Include generated components
    add_subdirectory(generated/vss_files/bs_wipermode)
    add_subdirectory(generated/vss_files/vd_wipermode)
    add_subdirectory(generated/vss_files/vd_rainsensor)
    add_subdirectory(generated/vss_files/bs_rainsensor)

    add_subdirectory(generated/vss_files/vd_frontwiper)
    add_subdirectory(generated/vss_files/bs_frontwiper)
    add_subdirectory(generated/vss_files/vd_rearwiper)
    add_subdirectory(generated/vss_files/bs_rearwiper)

Be aware that the `execute_process` is a configuration-time command of CMake, not a build-time command.

.. note::

   **Step Reach**
   
   By following this guide, you have learned how to:
   
   - Prepare input signal definitions in a CSV file.
   - Use the `SDV_VSS_UTIL` tool to generate VSS components.
   - Understand the structure of the generated files.
   - Compile IDL interfaces using `SDV_IDL_COMPILER`.
   - Automate the entire process using CMake.
